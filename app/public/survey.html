<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <title>Survey</title>
</head>
<style>
    img {
        width: 100%;
    }
</style>

<body>
    <div class="container">

        <div class="jumbotron">
            <div class="form-group">
                <label for="exampleFormControlInput1">Name</label>
                <input type="text" class="form-control" id="name" placeholder="Name">
            </div>
            <div class="form-group">
                <label for="exampleFormControlInput1">Picture</label>
                <input type="text" class="form-control" id="picture" placeholder="picture">
            </div>
            <a href="/">Back to home</a>

        </div>



        <div class="form-group">
            <div class="form-group">
                <h2>Question 1</h2>
                <label for="question1">How do you feel about question 1</label>
                <select class="form-control" id="question1">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>

            <div class="form-group">
                <label for="question2">How do you feel about question 2</label>
                <select class="form-control" id="question2">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question3">How do you feel about question 3</label>
                <select class="form-control" id="question3">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question4">How do you feel about question 4</label>
                <select class="form-control" id="question4">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question5">How do you feel about question 5</label>
                <select class="form-control" id="question5">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>

            <div class="form-group">
                <label for="question6">How do you feel about question 6</label>
                <select class="form-control" id="question6">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>

            <div class="form-group">
                <label for="question7">How do you feel about question 7</label>
                <select class="form-control" id="question7">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>

            <div class="form-group">
                <label for="question8">How do you feel about question 8</label>
                <select class="form-control" id="question8">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>

            <div class="form-group">
                <label for="question9">How do you feel about question 9</label>
                <select class="form-control" id="question9">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>

            <div class="form-group">
                <label for="question10">How do you feel about question 10</label>
                <select class="form-control" id="question10">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>

            <button id="submit-form" type="button" class="btn btn-primary" data-toggle="modal"
                data-target="#exampleModalLong">Submit</button>

            <!-- Modal -->
            <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">Friend Found!!</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="matched-name"></div>
                            <div class="matched-body"></div>
                            <div class="matched-msg"></div>
                            <div class="user-body"></div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script type="text/javascript">
        $("#submit-form").on("click", function (event) {
            event.preventDefault();
            var newArr = []
            var name = $("#name").val().trim()
            var picture = $("#picture").val().trim()
            var question1 = parseInt($("#question1").val().trim());
            var question2 = parseInt($("#question2").val().trim());
            var question3 = parseInt($("#question3").val().trim());
            var question4 = parseInt($("#question4").val().trim());
            var question5 = parseInt($("#question5").val().trim());
            var question6 = parseInt($("#question6").val().trim());
            var question7 = parseInt($("#question7").val().trim());
            var question8 = parseInt($("#question8").val().trim());
            var question9 = parseInt($("#question9").val().trim());
            var question10 = parseInt($("#question10").val().trim());

            newArr.push(question1, question2, question3, question4, question5,
                question6, question7, question8, question9, question10)
            var questionsArr = {
                name: name,
                photo: picture,
                scores: newArr,
            }
            var bestMatch = {
                name: '',
                difference: 1000
            }

            $.post("/api/friends", questionsArr)
                .then(function (data) {
                    // $(".user-body").empty();
                    // $(".user-body").append(questionsArr.name)
                    // $(".user-body").append(picture)
                });

            $.get("/api/friends", function (data) {
                for (var i = 0; i < data.length - 1; i++) {
                    var difference = 0;
                    for (var j = 0; j < data[i].scores.length; j++) {
                        difference += Math.abs(data[i].scores[j] - questionsArr.scores[j])
                        if (j === (data[i].scores.length - 1)) {
                            if (bestMatch.difference > difference) {
                                bestMatch.difference = difference
                                bestMatch.name = data[i].name
                                bestMatch.photo = data[i].photo
                                bestMatch.message = data[i].message
                            }
                        }
                    }
                }
                console.log(bestMatch)
                $(".matched-name").text(bestMatch.name)
                $(".matched-msg").text(bestMatch.message)
                $(".matched-body").empty()
                $(".matched-body").append("<img src=" + bestMatch.photo + ">")
            })
        });
    </script>


</body>

</html>